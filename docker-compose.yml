version: "3.9"

services:
  vm1:
    image: ${DOCKER_VM_RUNNER_IMAGE:-ghcr.io/munenick/docker-vm-runner:latest}
    container_name: ${VM1_NAME:-vm1}
    devices:
      - /dev/kvm:/dev/kvm
    volumes:
      - ./images:/images
      - ./images/state:/var/lib/docker-vm-runner
      - ./distros.yaml:/config/distros.yaml:ro
    environment:
      DISTRO: ${VM1_DISTRO:-ubuntu-2404}
      GUEST_NAME: ${VM1_GUEST_NAME:-vm1}
      ARCH: ${VM1_ARCH:-x86_64}
      CPU_MODEL: ${VM1_CPU_MODEL:-host}
      CPUS: ${VM1_CPUS:-2}
      MEMORY: ${VM1_MEMORY:-4096}
      DISK_SIZE: ${VM1_DISK_SIZE:-20G}
      GRAPHICS: ${VM1_GRAPHICS:-none}
      VNC_PORT: ${VM1_VNC_PORT:-5900}
      NOVNC_PORT: ${VM1_NOVNC_PORT:-6080}
      BASE_IMAGE: ${VM1_BASE_IMAGE:-}
      BLANK_DISK: ${VM1_BLANK_DISK:-0}
      BOOT_ISO: ${VM1_BOOT_ISO:-}
      BOOT_ORDER: ${VM1_BOOT_ORDER:-hd}
      CLOUD_INIT: ${VM1_CLOUD_INIT:-1}
      GUEST_PASSWORD: ${VM1_GUEST_PASSWORD:-password}
      SSH_PORT: ${VM1_SSH_PORT:-2222}
      SSH_PUBKEY: ${VM1_SSH_PUBKEY:-}
      PERSIST: ${VM1_PERSIST:-1}
      EXTRA_ARGS: ${VM1_EXTRA_ARGS:-}
      REDFISH_ENABLE: ${VM1_REDFISH_ENABLE:-0}
      REDFISH_USERNAME: ${VM1_REDFISH_USERNAME:-admin}
      REDFISH_PASSWORD: ${VM1_REDFISH_PASSWORD:-password}
      REDFISH_PORT: ${VM1_REDFISH_PORT:-8443}
    ports:
      - "${VM1_SSH_PORT:-2222}:${VM1_SSH_PORT:-2222}"
      - "${VM1_REDFISH_PORT:-8443}:${VM1_REDFISH_PORT:-8443}"
      - "${VM1_VNC_PORT:-5900}:${VM1_VNC_PORT:-5900}"
      - "${VM1_NOVNC_PORT:-6080}:${VM1_NOVNC_PORT:-6080}"
    hostname: ${VM1_NAME:-vm1}
    stdin_open: true
    tty: true
    restart: unless-stopped

  # Duplicate this block (vm2, vm3, ...) for additional VMs.
